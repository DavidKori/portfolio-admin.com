import{r as l,U as F,m,j as e}from"./index-BsKevn0t.js";import{C as $}from"./ConfirmModal-hy6Da3yH.js";import{u as O}from"./useToast-CHd64vW6.js";/* empty css                */const y=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=(n,i=100)=>n.length<=i?n:n.substring(0,i)+"...",H=()=>{const{unreadCount:n,setUnreadCount:i}=l.useContext(F),[h,u]=l.useState([]),[M,w]=l.useState([]),[C,S]=l.useState(!0),[k,g]=l.useState(!1),[d,f]=l.useState(null),[t,v]=l.useState(null),[c,A]=l.useState(""),[o,D]=l.useState("all"),{showSuccess:N,showError:p}=O(),[x,j]=l.useState(0);l.useEffect(()=>{b()},[]),l.useEffect(()=>{_()},[h,c,o]);const b=async()=>{try{const s=await m.getAll(),a=await m.getUnread();u(s.data||[]),j(a.data.length||0),i(a.data.length||0)}catch(s){console.error("Failed to fetch messages:",s)}finally{S(!1)}},_=()=>{let s=[...h];if(c){const a=c.toLowerCase();s=s.filter(r=>r.name?.toLowerCase().includes(a)||r.email?.toLowerCase().includes(a)||r.message?.toLowerCase().includes(a))}o==="read"?s=s.filter(a=>a.read):o==="unread"&&(s=s.filter(a=>!a.read)),s.sort((a,r)=>new Date(r.createdAt)-new Date(a.createdAt)),w(s)},T=async s=>{try{await m.markAsRead(s),u(a=>a.map(r=>r._id===s?{...r,read:!0}:r)),N("Message marked as read")}catch{p("Failed to mark message as read")}},L=async()=>{try{const s=h.filter(a=>!a.read);console.log(s),await Promise.all(s.map(a=>m.markAsRead(a._id))),u(a=>a.map(r=>({...r,read:!0}))),j(0),i(0),N("All messages marked as read")}catch{p("Failed to mark all messages as read")}},R=async()=>{if(d)try{await m.delete(d._id),u(s=>s.filter(a=>a._id!==d._id)),d.read||(j(x-1),i(n-1)),N("Message deleted successfully"),t&&t._id===d._id&&v(null)}catch{p("Failed to delete message")}finally{f(null),g(!1)}},U=async s=>{v(s),s.read||(await T(s._id),j(x-1),i(n-1))},E=()=>h.filter(s=>!s.read).length;return C?e.jsx("div",{className:"section-loading",children:"Loading messages..."}):e.jsxs("div",{className:"section-container",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{children:"Messages"}),e.jsx("p",{children:"Manage messages from portfolio visitors"})]}),e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"messages-controls",children:[e.jsxs("div",{className:"search-filter",children:[e.jsx("input",{type:"text",placeholder:" ðŸ” Search messages...",value:c,onChange:s=>A(s.target.value),className:"search-input"}),e.jsxs("select",{value:o,onChange:s=>D(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"All Messages"}),e.jsx("option",{value:"unread",children:"Unread Only"}),e.jsx("option",{value:"read",children:"Read Only"})]}),e.jsx("button",{onClick:L,className:"btn-secondary",disabled:E()===0,children:"Mark All as Read"})]}),x!==0&&e.jsx("div",{className:"unreadMsg-container",children:e.jsxs("span",{children:[x," New Messages "]})})]}),e.jsxs("div",{className:"messages-layout",children:[e.jsx("div",{className:"messages-list",children:M.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"âœ‰ï¸"}),e.jsx("h3",{children:"No Messages Found"}),e.jsx("p",{children:c||o!=="all"?"No messages match your search criteria":"No messages yet. They will appear here when visitors contact you."})]}):e.jsx("div",{className:"messages-container",children:M.map(s=>e.jsxs("div",{className:`message-item ${s.read?"":"unread"} ${t?._id===s._id?"selected":""}`,onClick:()=>U(s),children:[e.jsxs("div",{className:"message-header",children:[e.jsxs("div",{className:"message-sender",children:[e.jsx("div",{className:"sender-name",children:s.name}),e.jsx("div",{className:"sender-email",children:s.email})]}),e.jsx("div",{className:"message-time",children:y(s.createdAt)})]}),e.jsx("div",{className:"message-preview",children:P(s.message,100)}),!s.read&&e.jsx("div",{className:"unread-badge",children:"New"}),e.jsx("div",{className:"message-actions",children:e.jsx("button",{className:"delete-btn",onClick:a=>{a.stopPropagation(),f(s),g(!0)},title:"Delete message",children:"Delete"})})]},s._id))})}),e.jsx("div",{className:"message-detail",children:t?e.jsxs("div",{className:"detail-card",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("h3",{children:["Message from ",t.name]}),e.jsx("button",{className:"close-detail",onClick:()=>v(null),children:"âœ•"})]}),e.jsxs("div",{className:"detail-meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("strong",{children:"Sent:"})," ",y(t.createdAt)]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:`status-badge ${t.read?"read":"unread"}`,children:t.read?"Read":"Unread"})]})]}),e.jsx("div",{className:"detail-content",children:e.jsx("p",{children:t.message})}),e.jsxs("div",{className:"detail-actions",children:[e.jsx("a",{href:`https://mail.google.com/mail/?view=cm&to=${t.email}.com`,target:"_blank",rel:"noopener noreferrer",class:"reply-btn",children:"Reply via Email"}),e.jsx("button",{className:"btn-delete",onClick:()=>{f(t),g(!0)},children:"Delete"})]})]}):e.jsxs("div",{className:"select-message-prompt",children:[e.jsx("div",{className:"prompt-icon",children:"ðŸ‘ˆ"}),e.jsx("h3",{children:"Select a Message"}),e.jsx("p",{children:"Click on a message from the list to view its details here."})]})})]})]}),e.jsx($,{isOpen:k,onClose:()=>g(!1),onConfirm:R,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete Message"})]})};export{H as default};
