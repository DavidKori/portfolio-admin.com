import{r as i,m as h,j as e}from"./index-DN2QgEtp.js";import{C as R}from"./ConfirmModal-87vAIZv7.js";import{u as E}from"./useToast-C_6R7hpL.js";/* empty css                */const v=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=(r,n=100)=>r.length<=n?r:r.substring(0,n)+"...",P=()=>{const[r,n]=i.useState([]),[f,N]=i.useState([]),[p,y]=i.useState(!0),[M,o]=i.useState(!1),[m,u]=i.useState(null),[t,g]=i.useState(null),[c,w]=i.useState(""),[d,S]=i.useState("all"),{showSuccess:x,showError:j}=E();i.useEffect(()=>{C()},[]),i.useEffect(()=>{k()},[r,c,d]);const C=async()=>{try{const s=await h.getAll();n(s.data||[])}catch(s){console.error("Failed to fetch messages:",s)}finally{y(!1)}},k=()=>{let s=[...r];if(c){const a=c.toLowerCase();s=s.filter(l=>l.name?.toLowerCase().includes(a)||l.email?.toLowerCase().includes(a)||l.message?.toLowerCase().includes(a))}d==="read"?s=s.filter(a=>a.read):d==="unread"&&(s=s.filter(a=>!a.read)),s.sort((a,l)=>new Date(l.createdAt)-new Date(a.createdAt)),N(s)},A=async s=>{try{await h.markAsRead(s),n(a=>a.map(l=>l._id===s?{...l,read:!0}:l)),x("Message marked as read")}catch{j("Failed to mark message as read")}},D=async()=>{try{const s=r.filter(a=>!a.read);await Promise.all(s.map(a=>h.markAsRead(a._id))),n(a=>a.map(l=>({...l,read:!0}))),x("All messages marked as read")}catch{j("Failed to mark all messages as read")}},b=async()=>{if(m)try{await h.delete(m._id),n(s=>s.filter(a=>a._id!==m._id)),x("Message deleted successfully"),t&&t._id===m._id&&g(null)}catch{j("Failed to delete message")}finally{u(null),o(!1)}},_=async s=>{g(s),s.read||await A(s._id)},T=()=>r.filter(s=>!s.read).length;return p?e.jsx("div",{className:"section-loading",children:"Loading messages..."}):e.jsxs("div",{className:"section-container",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{children:"Messages"}),e.jsx("p",{children:"Manage messages from portfolio visitors"})]}),e.jsxs("div",{className:"section-content",children:[e.jsx("div",{className:"messages-controls",children:e.jsxs("div",{className:"search-filter",children:[e.jsx("input",{type:"text",placeholder:"Search messages...",value:c,onChange:s=>w(s.target.value),className:"search-input"}),e.jsxs("select",{value:d,onChange:s=>S(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"All Messages"}),e.jsx("option",{value:"unread",children:"Unread Only"}),e.jsx("option",{value:"read",children:"Read Only"})]}),e.jsx("button",{onClick:D,className:"btn-secondary",disabled:T()===0,children:"Mark All as Read"})]})}),e.jsxs("div",{className:"messages-layout",children:[e.jsx("div",{className:"messages-list",children:f.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"âœ‰ï¸"}),e.jsx("h3",{children:"No Messages Found"}),e.jsx("p",{children:c||d!=="all"?"No messages match your search criteria":"No messages yet. They will appear here when visitors contact you."})]}):e.jsx("div",{className:"messages-container",children:f.map(s=>e.jsxs("div",{className:`message-item ${s.read?"":"unread"} ${t?._id===s._id?"selected":""}`,onClick:()=>_(s),children:[e.jsxs("div",{className:"message-header",children:[e.jsxs("div",{className:"message-sender",children:[e.jsx("div",{className:"sender-name",children:s.name}),e.jsx("div",{className:"sender-email",children:s.email})]}),e.jsx("div",{className:"message-time",children:v(s.createdAt)})]}),e.jsx("div",{className:"message-preview",children:F(s.message,100)}),!s.read&&e.jsx("div",{className:"unread-badge",children:"New"}),e.jsx("div",{className:"message-actions",children:e.jsx("button",{className:"delete-btn",onClick:a=>{a.stopPropagation(),u(s),o(!0)},title:"Delete message",children:"Delete"})})]},s._id))})}),e.jsx("div",{className:"message-detail",children:t?e.jsxs("div",{className:"detail-card",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("h3",{children:["Message from ",t.name]}),e.jsx("button",{className:"close-detail",onClick:()=>g(null),children:"âœ•"})]}),e.jsxs("div",{className:"detail-meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("strong",{children:"Sent:"})," ",v(t.createdAt)]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:`status-badge ${t.read?"read":"unread"}`,children:t.read?"Read":"Unread"})]})]}),e.jsx("div",{className:"detail-content",children:e.jsx("p",{children:t.message})}),e.jsxs("div",{className:"detail-actions",children:[e.jsx("a",{href:`https://mail.google.com/mail/?view=cm&to=${t.email}.com`,target:"_blank",rel:"noopener noreferrer",class:"reply-btn",children:"âœ‰ï¸ Reply via Email"}),e.jsx("button",{className:"btn-delete",onClick:()=>{u(t),o(!0)},children:"Delete Message"})]})]}):e.jsxs("div",{className:"select-message-prompt",children:[e.jsx("div",{className:"prompt-icon",children:"ðŸ‘ˆ"}),e.jsx("h3",{children:"Select a Message"}),e.jsx("p",{children:"Click on a message from the list to view its details here."})]})})]})]}),e.jsx(R,{isOpen:M,onClose:()=>o(!1),onConfirm:b,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete Message"})]})};export{P as default};
